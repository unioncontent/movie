<div class="main-body">
  <div class="page-wrapper">
    <div class="page-header">
      <div class="page-header-title">
        <h4>미리보기/발송</h4>
      </div>
      <div class="page-header-breadcrumb">
        <ul class="breadcrumb-title">
          <li class="breadcrumb-item">
            <a href="/">
              <i class="fas fa-home"></i>
            </a>
          </li>
          <li class="breadcrumb-item"><a href="#!">미리보기/발송</a></li>
        </ul>
      </div>
    </div>
    <div class="page-body">
      <div class="row">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header">
              <button type="submit" class="btn btn-inverse f-right m-b-0 sendBtn">발송</button>
            </div>
            <div class="card-block">
              <div class="form-group row">
                <label class="col-sm-2 col-form-label">* 발송형태</label>
                <div id="type" class="form-radio">
                  <div class="col-sm-12">
                    <div class="radio radiofill radio-inverse radio-inline">
                      <label>
                        <input type="radio" value="0" name="M_type" checked>
                        <i class="helper"></i>즉시
                      </label>
                    </div>
                    <div class="radio radiofill radio-inverse radio-inline">
                      <label>
                        <input type="radio" value="1" name="M_type">
                        <i class="helper"></i>예약
                      </label>
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-group row reserveTime" style="display:none;">
                <label class="col-sm-2 col-form-label">* 예약시간</label>
                <div class="col-sm-5 row">
                  <div class='col-sm-6 input-group p-r-0'>
                    <span class="input-group-addon bg-inverse">
                      <span class="far fa-calendar-alt"></span>
                    </span>
                    <input type="text" id="datepicker" class="form-control" />
                  </div>
                  <div class='col-sm-6 input-group p-r-0' id="date">
                    <span class="input-group-addon bg-inverse">
                      <span class="far fa-clock"></span>
                    </span>
                    <input type="text" id="timepicker" class="form-control" />
                  </div>
                  <span class='messages p-l-15'><p class='text-danger error'></p></span>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-sm-2 col-form-label">* 보내는 사람</label>
                <div class="col-sm-5">
                  <select id="M_sender" class="sender-select col-sm-12 form-control select2-hidden-accessible" tabindex="-1" aria-hidden="true">
                  </select>
                  <span class='messages'><p class='text-danger error'></p></span>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-sm-2 col-form-label">* 받는 사람</label>
                <div class="col-sm-5">
                  <select id="M_recipi" class="recipi-select col-sm-12 form-control select2-hidden-accessible" multiple="" tabindex="-1" aria-hidden="true">
                  </select>
                  <span class='messages'><p class='text-danger error'></p></span>
                </div>
                <div class="col-sm-1 btn-check3">
                  <button type="button" class="btn btn-inverse btn-modal">주소록</button>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-sm-2 col-form-label">수신자 그룹</label>
                <div class="col-sm-5">
                  <select id="M_group" class="group-select col-sm-12 form-control select2-hidden-accessible" tabindex="-1" aria-hidden="true">
                  </select>
                  <span class='messages'><p class='text-danger error'></p></span>
                </div>
                <div class="col-sm-1 btn-check1">
                  <button type="button" class="btn btn-inverse btn-modal">주소록</button>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-sm-2 col-form-label">* 보고날짜</label>
                <div class="col-sm-5">
                  <input type="text" id="datepicker2" class="form-control" />
                </div>
              </div>
              <div class="form-group row">
                <label class="col-sm-2 col-form-label">* 메일내용</label>
                <div class="col-sm-10" style="overflow-x:  auto;overflow-y: hidden;">
                  <div id="M_body" style="float:left;font-family: 굴림, Gulim, Arial, sans-serif;"> <div id="header"> <img src="http://showbox.email/images/newsclipping/header.jpg" alt="" style="display: inherit;"> <div id="info" style="background-color: #f7f7f7;height: 37px;"> <span style="padding: 10px;padding-left: 15px;display: inline-block;font-size: 11px;color: #686868;">ShowBox News Clipping</span> <span id="date-span" style="float: right;display: inline-block;padding: 8px;padding-right: 25px;line-height: 17px;"> <a href="" target="_blank" style="cursor:pointer;text-decoration: blink;font-size: 11px;color: #686868">2018.06.01 (금)</a> </span> </div></div><div id="body" style="padding:27px 24px;padding:27px 24px;padding-top: 0px;"> <div id="body-header" style="display:none;"> <table style="border-collapse: collapse;border-spacing: 0;"> <tbody> <tr> <td style="width: 133px;height: 42px;border: 1px solid #e3e3e3;text-align: center;"> <a href="" target="_blank" style="text-decoration: blink;font-size: 12px;color: #878787;">주요뉴스</a> </td><td style="width: 133px;height: 42px;border: 1px solid #e3e3e3;text-align: center;"> <a href="" target="_blank" style="text-decoration: blink;font-size: 12px;color: #878787;">키워드 이슈</a> </td><td style="width: 133px;height: 42px;border: 1px solid #e3e3e3;text-align: center;"> <a href="" target="_blank" style="text-decoration: blink;font-size: 12px;color: #878787;">박스오피스</a> </td><td style="width: 133px;height: 42px;border: 1px solid #e3e3e3;text-align: center;"> <a href="" target="_blank" style="text-decoration: blink;font-size: 12px;color: #878787;">기업 뉴스</a> </td></tr></tbody> </table> </div><div id="body-content"> <div class="section" data-type="1" style="padding-top:24px"> <div class="section-header" style="border-bottom: 2px solid #efefef;padding-bottom: 3px;"> <img src="http://showbox.email/images/newsclipping/icon.jpg" alt="" style="display: inherit; float:left;"> <span style="font-family:NanumGothic;font-size: 16px;padding-left: 5px; float:left;">쇼박스 영화</span> <span style="font-family:Gulim;font-size: 12px;padding-left: 5px;color: #868686;line-height: 2;">쇼박스 영화 일일 주요뉴스</span> </div><div class="section-body" style="font-family: 굴림, Gulim, Arial, sans-serif;"> </div></div><div class="section" data-type="2" style="padding-top:50px"> <div class="section-header" style="border-bottom: 2px solid #efefef;padding-bottom: 3px;"> <img src="http://showbox.email/images/newsclipping/icon.jpg" alt="" style="display: inherit; float:left;"> <span style="font-family:NanumGothic;font-size: 16px;padding-left: 5px; float:left;">경쟁 영화</span> <span style="font-family:Gulim;font-size: 12px;padding-left: 5px;color: #868686;line-height: 2;">경쟁 영화 일일 주요뉴스</span> </div><div class="section-body" style="font-family: 굴림, Gulim, Arial, sans-serif;"> </div></div><div class="section" data-type="5" style="padding-top:50px"> <div class="section-header" style="border-bottom: 2px solid #efefef;padding-bottom: 3px;"> <img src="http://showbox.email/images/newsclipping/icon.jpg" alt="" style="display: inherit; float:left;"> <span style="font-family:NanumGothic;font-size: 16px;padding-left: 5px; float:left;">영화 일반</span> <span style="font-family:Gulim;font-size: 12px;padding-left: 5px;color: #868686;line-height: 2;">영화 일반 일일 주요뉴스</span> </div><div class="section-body" style="font-family: 굴림, Gulim, Arial, sans-serif;"> </div></div><div class="section" data-type="6" style="padding-top:50px"> <div class="section-header" style="border-bottom: 2px solid #efefef;padding-bottom: 3px;"> <img src="http://showbox.email/images/newsclipping/icon.jpg" alt="" style="display: inherit; float:left;"> <span style="font-family:NanumGothic;font-size: 16px;padding-left: 5px; float:left;">보도국</span> <span style="font-family:Gulim;font-size: 12px;padding-left: 5px;color: #868686;line-height: 2;">보도국 일일 주요뉴스</span> </div><div class="section-body" style="font-family: 굴림, Gulim, Arial, sans-serif;"> </div></div><div class="section" data-type="3" style="padding-top:50px"> <div class="section-header" style="border-bottom: 2px solid #efefef;padding-bottom: 3px;"> <img src="http://showbox.email/images/newsclipping/icon.jpg" alt="" style="display: inherit; float:left;"> <span style="font-family:NanumGothic;font-size: 16px;padding-left: 5px; float:left;">캐스팅</span> <span style="font-family:Gulim;font-size: 12px;padding-left: 5px;color: #868686;line-height: 2;">캐스팅 일일 주요뉴스</span> </div><div class="section-body" style="font-family: 굴림, Gulim, Arial, sans-serif;"> </div></div><div class="section" data-type="issue" style="padding-top:50px"> <div class="section-header" style="border-bottom: 2px solid #efefef;padding-bottom: 8px;height: 31px;"> <img src="http://showbox.email/images/newsclipping/icon.jpg" alt="" style="display: inherit; float:left;"> <span style="font-family:NanumGothic;font-size: 16px;padding-left: 5px; float:left;">키워드이슈</span> </div><div class="section-body" style="font-family: 굴림, Gulim, Arial, sans-serif;"> <table style="border-collapse: collapse;border-spacing: 0;"> <colgroup> <col width="140px"> <col width="411px"> </colgroup> <tbody style="font-family:Gulim; font-size:12px"> </tbody> </table> </div></div><div class="section" data-type="marketing" style="padding-top:50px"> <div class="section-header" style="border-bottom: 2px solid #efefef;padding-bottom: 8px;height: 31px;"> <img src="http://showbox.email/images/newsclipping/icon.jpg" alt="" style="display: inherit; float:left;"> <span style="font-family:NanumGothic;font-size: 16px;padding-left: 5px; float:left;">마케팅채널관리</span> </div><div class="section-body" style="font-family: 굴림, Gulim, Arial, sans-serif;"> <table style="width:100%; font-size: 12px;border-collapse: collapse;border-spacing: 0;"> <colgroup> <col width="377px"/> <col width="83px"/> <col width="83px"/> <col width="83px"/> </colgroup> <tbody> </tbody> </table> </div></div><div class="section" data-type="movie" style="padding-top:50px"> <div class="section-header" style="border-bottom: 2px solid #efefef;padding-bottom: 8px;height: 31px;"> <img src="http://showbox.email/images/newsclipping/icon.jpg" alt="" style="display: inherit; float:left;"> <span style="font-family:NanumGothic;font-size: 16px;padding-left: 5px; float:left;">박스오피스</span> <a href="http://movie.daum.net/boxoffice/weekly" target="_blank"> <img src="http://showbox.email/images/newsclipping/link_icon.jpg" alt="" style="display: inherit;float:left;padding-top: 5px;padding-left: 11px;"> </a> </div><div class="section-body" style="font-family: 굴림, Gulim, Arial, sans-serif;"> <div data-type="7"> </div><table style="font-family: 굴림;font-size:12px;margin-top: 22px;"> <colgroup> <col width="40px"> <col width="340px"> <col width="111px"> <col width="50px"> </colgroup> <tbody id="movieList"> </tbody> </table> </div></div><div class="section" data-type="4" style="padding-top:50px"> <div class="section-header" style="border-bottom: 2px solid #efefef;padding-bottom: 8px;height: 31px;"> <img src="http://showbox.email/images/newsclipping/icon.jpg" alt="" style="display: inherit; float:left;"> <span style="font-family:NanumGothic;font-size: 16px;padding-left: 5px; float:left;">쇼박스 기업 뉴스</span> </div><div class="section-body" style="font-family: 굴림, Gulim, Arial, sans-serif;"> <table style="width:100%; font-size: 12px;border-collapse: collapse;border-spacing: 0;"> <colgroup> <col width="377px"/> <col width="83px"/> <col width="83px"/> </colgroup> <tbody> <tr class="head"> <td colspan="3" style="padding: 10px 0;border-bottom: 1px solid #dddddd;"> <span style="font-family:NanumGothic;font-size: 35px;font-weight: 500; padding:5px;">쇼박스</span> <a href="http://finance.naver.com/item/news.nhn?code=086980" target="_blank"> <img src="http://showbox.email/images/newsclipping/link_icon.jpg" alt="" style="display: inherit;float:right;padding-top: 23px;padding-left: 11px;"> </a> </td></tr></tbody> </table> </div></div></div></div></div>
                </div>
              </div>
            </div>
            <div class="card-bottom">
              <button type="submit" class="btn btn-inverse f-right m-b-0 sendBtn">발송</button>
            </div>
          </div>
        </div>
      </div>
      <!-- Modal start-->
      <div class='modal fade' id='mailList-Modal' role='dialog'>
        <div class='modal-dialog modal-lg' role='document'>
          <div class='modal-content'>
            <div class='modal-header'>
              <h5 class="modal-title">메일 주소록</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">×</span>
              </button>
            </div>
            <div class='modal-body p-b-0'>
              <div class='card m-b-0'>
                <div class="card-block table-border-style">
                  <div class="table-responsive">
                    <table class="table table-columned">
                      <tbody>
                        <tr>
                          <td rowspan='4'>
                            <div class="right-icon-control m-b-5">
                              <input type="text" class="form-control  search-text" placeholder="메일주소찾기(이름/이메일/회사)" id="searchMail">
                              <div class="form-icon">
                                <i class="fas fa-search"></i>
                              </div>
                            </div>
                            <div class="listBox">
                              <ul>
                                <li class="hasmenu">
                                  <h3 class="menubar">
                                    전체선택(현재 리스트)
                                    <i class="fas fa-sort-down float-right m-r-5"></i>
                                    <i class="fas fa-sort-up float-right m-r-5" style="display:none;"></i>
                                  </h3>
                                  <ul class="submenu">
                                    <li>
                                      <input id="chk_1" class="allCheck" type="checkbox" value="All"/>
                                      <label for="chk_1" title="그룹/이메일 전체선택">그룹/이메일 전체선택</label>
                                    </li>
                                    <li>
                                      <input id="chk_2" class="allCheck" type="checkbox" value="emailAll"/>
                                      <label for="chk_2" title="이메일 전체선택">이메일 전체선택</label>
                                    </li>
                                    <li>
                                      <input id="chk_3" class="allCheck" type="checkbox" value="groupAll"/>
                                      <label for="chk_3" title="그룹 전체선택">그룹 전체선택</label>
                                    </li>
                                  </ul>
                                </li>
                              </ul>
                            </div>
                            <div class="listBox">
                              <ul>
                                <li class="hasmenu">
                                  <h3 class="menubar">
                                    그룹
                                  </h3>
                                </li>
                                <ul class="submenu groupLi">
                                  <% for(var i=0; i < groupList.length; i++) { %>
                                    <li>
                                      <input type="checkbox" id="chk<%=i+1%>_g" value="<%=groupList[i].M_group_title%>" title="<%= groupList[i].M_group_title %>&lt;<%=groupList[i].groupCount%>명&gt;"/>
                                      <label for="chk<%=i+1%>_g" title="<%= groupList[i].M_group_title %>&lt;<%=groupList[i].groupCount%>명&gt;"><%= groupList[i].M_group_title%>&lt;<%=groupList[i].groupCount%>명&gt;</label>
                                    </li>
                                    <% }; %>
                                </ul>
                              </ul>
                            </div>
                            <div class="paging">
                              <input type="hidden" data-type="group" value="<%=groupListPageNum%>"/>
                              <input type="text" data-type="group" value="<%=groupListPageNum%>"/>
                               / <p class="count"><%=(Math.ceil(groupListCount/10) < 1)? 1 : Math.ceil(groupListCount/10)%></p>
                              <div class="bottomBtn">
                                <button class="btn btn-default btn-sm" data-type="group" data-value="first" data-num="0"><i class="fas fa-angle-double-left"></i></button>
                                <button class="btn btn-default btn-sm" data-type="group" data-value="prev" data-num="<%=(groupListPageNum != 1) ? groupListPageNum-1 : 0%>"><i class="fas fa-chevron-left"></i></button>
                                <button class="btn btn-default btn-sm" data-type="group" data-value="next" data-num="<%=(groupListPageNum != groupListCount) ? groupListPageNum+1 : groupListCount%>"><i class="fas fa-chevron-right"></i></button>
                                <button class="btn btn-default btn-sm" data-type="group" data-value="end" data-num="<%=Math.ceil(groupListCount/10)%>"><i class="fas fa-angle-double-right"></i></button>
                              </div>
                            </div>
                            <div class="listBox">
                              <ul>
                                <li class="hasmenu">
                                  <h3>이메일</h3>
                                  <ul class="submenu emailLi">
                                    <% for(var i=0; i < mailList.length; i++) { %>
                                      <li>
                                        <input type="checkbox" id="chk<%=i+1%>" value="<%=mailList[i].n_idx%>" title="<%= mailList[i].M_name %>&lt;<%=mailList[i].M_email%>&gt;"/>
                                        <label for="chk<%=i+1%>" title="<%= mailList[i].M_name %>&lt;<%=mailList[i].M_email%>&gt;"><%= mailList[i].M_name%>&lt;<%=mailList[i].M_email%>&gt;</label>
                                      </li>
                                      <% }; %>
                                  </ul>
                                </li>
                              </ul>
                            </div>
                            <div class="paging">
                              <input type="hidden" data-type="mail" value="<%=mailListPageNum%>"/>
                              <input type="text" data-type="mail" value="<%=mailListPageNum%>"/>
                               / <p class="count"><%=(Math.ceil(mailListCount/10) < 1)? 1 : Math.ceil(mailListCount/10)%></p>
                              <div class="bottomBtn">
                                <button class="btn btn-default btn-sm" data-type="mail" data-value="first" data-num="0"><i class="fas fa-angle-double-left"></i></button>
                                <button class="btn btn-default btn-sm" data-type="mail" data-value="prev" data-num="<%=(mailListPageNum != 1) ? (mailListPageNum-1) * 10 : 0%>"><i class="fas fa-chevron-left"></i></button>
                                <button class="btn btn-default btn-sm" data-type="mail" data-value="next" data-num="<%=(mailListPageNum != Math.ceil(mailListCount/10)) ? mailListPageNum * 10 : Math.ceil(mailListCount/10) * 10%>"><i class="fas fa-chevron-right"></i></button>
                                <button class="btn btn-default btn-sm" data-type="mail" data-value="end" data-num="<%=(Math.ceil(mailListCount/10)-1) * 10%>"><i class="fas fa-angle-double-right"></i></button>
                              </div>
                            </div>
                          </td>
                        </tr>
                        <tr>
                          <td>
                            <div class="rightLeftBtn">
                              <button class="btn btn-inverse btn-sm m-b-5" data-value="group" data-type="right"><i class="fas fa-chevron-right"></i></button>
                              <button class="btn btn-inverse btn-sm m-b-5" data-value="group" data-type="left"><i class="fas fa-chevron-left"></i></button>
                              <button class="btn btn-inverse btn-sm m-b-5" data-value="group" data-type="allLeft"><i class="fas fa-angle-double-left"></i></button>
                            </div>
                          </td>
                          <td class="rightTd">
                            <div class="selectedBox">
                              <h3>수신그룹(숨은참조) <span class="text-info">0</span></h3>
                              <div class="box">
                                <ul id="groupUl">

                                </ul>
                              </div>
                            </div>
                          </td>
                        </tr>
                        <tr>
                          <td>
                            <div class="rightLeftBtn">
                              <button class="btn btn-inverse btn-sm m-b-5" data-value="recipi" data-type="right"><i class="fas fa-chevron-right"></i></button>
                              <button class="btn btn-inverse btn-sm m-b-5" data-value="recipi" data-type="left"><i class="fas fa-chevron-left"></i></button>
                              <button class="btn btn-inverse btn-sm m-b-5" data-value="recipi" data-type="allLeft"><i class="fas fa-angle-double-left"></i></button>
                            </div>
                          </td>
                          <td>
                            <div class="selectedBox">
                              <h3>받는 사람 <span class="text-info" >0</span></h3>
                              <div class="box">
                                <ul id="recipiUl">

                                </ul>
                              </div>
                            </div>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-inverse" id="saveBtn">적용</button>
              <button type="button" class="btn btn-default" data-dismiss="modal">취소</button>
            </div>
          </div>
        </div>
      </div>
      <!-- Modal end-->
    </div>
  </div>
</div>
<!-- select2 -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.5/css/select2.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.5/js/select2.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.5/js/i18n/ko.js"></script>
<!-- alert -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert@2.1.0/dist/sweetalert.min.js"></script>
<!-- Bootstrap daterangepicker js -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-daterangepicker/2.1.27/daterangepicker.css" />
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-daterangepicker/2.1.27/moment.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-daterangepicker/2.1.27/daterangepicker.js"></script>
<!-- time  -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/wickedpicker@0.4.3/stylesheets/wickedpicker.css">
<script src="https://cdn.jsdelivr.net/npm/wickedpicker@0.4.3/dist/wickedpicker.min.js"></script>
<!-- custom -->
<link rel="stylesheet" href="/pages/email/style.css">
<link rel="stylesheet" href="/pages/email/style2.css">
<script src="/pages/email/js/modal.js"></script>
<script src="/pages/email/js/select2.js"></script>
<script src="/pages/email/js/movie.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    // ie label css
    $('.modal label').css('line-height','16px');
    $('.select2-search__field').css('line-height','16px');

    getNewsClippingData();
    boxoffice();
    var dateStr = $('#datepicker2').val().replace(/[-]/gi,'.');
    $('#date-span a').text(dateStr+' ('+getInputDayLabel($('#datepicker2').val())+')');
    $('#date-span a').attr('href', "http://showbox.email/preview/newsclipping?date="+$('#datepicker2').val());
    $('#body-header a').attr('href', "http://showbox.email/preview/newsclipping?date="+$('#datepicker2').val());
  });

  $('#datepicker2').on('change',function(){
    getNewsClippingData();
    boxoffice();
    var dateStr = $('#datepicker2').val().replace(/[-]/gi,'.');
    $('#date-span a').text(dateStr+' ('+getInputDayLabel($('#datepicker2').val())+')');
    $('#date-span a').attr('href', "http://showbox.email/preview/newsclipping?date="+$('#datepicker2').val());
    $('#body-header a').attr('href', "http://showbox.email/preview/newsclipping?date="+$('#datepicker2').val());
  });

  // 오늘 날짜
  function getTimeStamp() {
    var d = new Date();
    var date = leadingZeros(d.getFullYear(), 4) + '-' +
        leadingZeros(d.getMonth() + 1, 2) + '-' +
        leadingZeros(d.getDate(), 2);
    return date;
  }
  function leadingZeros(n, digits) {
    var zero = '';
    n = n.toString();

    if (n.length < digits) {
        for (i = 0; i < digits - n.length; i++)
            zero += '0';
    }
    return zero + n;
  }
  // 어제 날짜
  function yesterday(d,str){
    var dateStr = new Date(d);
    var yesterday = new Date(dateStr.valueOf() - (24*60*60*1000));

  	var yyyy = yesterday.getFullYear().toString();
  	var mm = (yesterday.getMonth()+1).toString(); // getMonth() is zero-based
  	var dd  = yesterday.getDate().toString();

  	var resultDate = yyyy + str + (mm[1]?mm:"0"+mm[0]) + str + (dd[1]?dd:"0"+dd[0]);
    return resultDate;
  }
  // 콤마
  function numberWithCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  }
  // 요일
  function getInputDayLabel(d) {
    var week = new Array('일', '월', '화', '수', '목', '금', '토');

    var today = new Date(d).getDay();
    var todayLabel = week[today];

    return todayLabel;
  }

  // 뉴스클리핑 세팅
  function getNewsClippingData(){
    var newsEDate = $('#datepicker2').val();
    var newsSDate = yesterday($('#datepicker2').val(),'-');

    $.ajax({
      url: '/newsclipping/getData',
      type: 'post',
      data : {
        sDate : newsSDate,
        eDate : newsEDate
      },
      datatype : 'json',
      error:function(request,status,error){
        console.log('code:'+request.status+'\n'+'message:'+request.responseText+'\n'+'error:'+error);
        swal("ERROR!", request.responseText, "error");
      },
      success:function(data){
        if(data.status){
          // 초기화
          $('.section:not(div[data-type=4],div[data-type=issue],div[data-type=marketing],div[data-type=movie]) .section-body').empty();
          $('div[data-type=issue] .section-body tbody tr:not(.head)').remove();
          $('div[data-type=marketing] .section-body tbody tr:not(.head)').remove();
          $('div[data-type=4] .section-body tbody tr:not(.head)').remove();
          $('div[data-type=7]').empty();
          // 생성
          $.each(data.result.issue, function(index, value) {
            var html = '<tr><td style="text-align:center; color: #ed1252;padding: 17px 0;border: 1px solid #f4f4f4; border-left: 0px; border-top: 0px; text-align: center;">#'+value.keyword+'</td><td style="border-bottom: 1px solid #f4f4f4;text-align: left;color: #666;"><div class="text" style="width: 380px;display: inline-block;padding: 10px;padding-right: 0px;white-space: pre-line;word-break: break-all;top: 4px;">'+value.issue_content+'</div></td></tr>';
            $('div[data-type=issue] .section-body tbody').append(html);
          });
          $.each(data.result.marketing, function(index, value) {
            var html = '<tr><td style="padding: 9px 7px 5px 11px;border-bottom: 1px solid #f4f4f4;"><img alt="'+value.ps_name+'" src="http://showbox.email/images/newsclipping/'+value.ps_name+'_logo.png" style="width: 13px;height: 13px;margin-bottom: 3px;margin-right: 5px;vertical-align: text-bottom;"><div class="text" style="width:294px;display: inline-block;text-overflow: ellipsis;overflow: hidden;vertical-align: baseline;white-space: nowrap;    top: 4px;"><a href="'+value.url+'" target="_blank" >'+value.ps_title+'</a></div><div class="info" style="color: #666;font-size: 11px;"><span class="date">총검출수 '+value.total_cnt+'</span><span class="bar" style="display: inline-block;overflow: hidden;width: 0;height: 11px;margin: -1px 5px 1px 4px;border-left: 1px solid #eaeaea;vertical-align: middle;"></span><span class="date">조회수 '+value.view_cnt+'</span><span class="bar" style="display: inline-block;overflow: hidden;width: 0;height: 11px;margin: -1px 5px 1px 4px;border-left: 1px solid #eaeaea;vertical-align: middle;"></span><span class="date">좋아요 '+value.like_cnt+'</span><span class="bar" style="display: inline-block;overflow: hidden;width: 0;height: 11px;margin: -1px 5px 1px 4px;border-left: 1px solid #eaeaea;vertical-align: middle;"></span><span class="date">댓글 '+value.reply_cnt+'</span></div></td><td style="border-bottom: 1px solid #f4f4f4;border-left: 1px solid #f4f4f4;text-align: center;color: #666;">'+value.ps_writer+'</td><td style="padding: 13px 0;border-bottom: 1px solid #f4f4f4;border-left: 1px solid #f4f4f4;text-align: center;color: #666;">'+value.writeDate+'</td></tr><tr><td colspan="3" style="border-bottom: 1px solid #d0cdcd;"><div class="text" style="width: 501px;display: inline-block;padding: 10px;white-space: pre-line;word-break: break-all;top: 4px;">'+((value.ps_content == null) ? '내용없음' :value.ps_content)+'</div></td></tr>';
            $('div[data-type=marketing] .section-body tbody').append(html);
          });
          var obj = new Object();
          $.each(data.result.news, function(index, value) {
            // 4.쇼박스기업뉴스
            if(value.news_type == "4"){
              //  title="'+value.media_title+'"
              var html = '<tr><td style="padding: 16px 7px;border-bottom: 1px solid #f4f4f4;"><div style="max-width: 371px;display: inline-block;text-overflow: ellipsis;overflow: hidden;white-space: nowrap;"><a href="'+value.url+'" target="_blank">'+value.media_title+'</a></div></td><td style="padding: 13px 0;border: 1px solid #f4f4f4;text-align: center;color: #666;">'+value.media_name+'</td><td style="padding: 13px 0;border-bottom: 1px solid #f4f4f4;text-align: center;color: #666;">'+value.writeDate+'</td></tr>'
              $('div[data-type='+value.news_type+'] .section-body tbody').append(html);
            }
            else{
              var html = '<div class="news" style="padding: 12px 5px 0px 5px">';
              // if(value.thumbnail != null && value.thumbnail != ''){
              //   html += '<img src="'+value.thumbnail+'" alt="" style="display: inherit; float:left;width:80px;height:80px;padding-right: 13px;">';
              // }
              html += '<div class="news-content"  data-idx="'+value.media_idx+'" style="font-size:12px;width:541px;height:  12px;"><div class="title" style="padding-bottom:5px;float:  left;max-width: 370px;display: inline-block;text-overflow: ellipsis;overflow: hidden;white-space: nowrap;"><a href="'+value.url+'" target="_blank">'+value.media_title+'</a></div><div clacss="info" style="padding-bottom:5px;color: #666;float:  right;"><span class="media-name">'+value.media_name+'</span> <span class="bar" style="display: inline-block;overflow: hidden;width: 0;height: 11px;margin: -1px 5px 1px 4px;border-left: 1px solid #eaeaea;vertical-align: middle;"></span> <span class="date">'+value.writeDate+'</span></div>';
              html +='</div></div>';
              if(value.news_detail != null && value.news_detail != ''){
                if(value.news_detail in obj){
                  obj[value.news_detail].push(value);
                }
                else{
                  obj[value.news_detail] = new Array();
                  obj[value.news_detail].push(value);
                }
              }
              else{
                if(value.news_type != '7'){
                  $('div[data-type='+value.news_type+'] .section-body').append(html);
                }
                else{
                  // console.log(value);
                  // console.log(html);
                  // console.log($('div[data-type='+value.news_type+']'));
                  $('div[data-type='+value.news_type+']').append(html);
                }
              }
            }
          });
          $.each(obj, function(index, value) {
            var html ='<ul class="relation_lst"  style="list-style: none;padding:0;margin: 13px;margin-left: 5px;line-height: 18px;position: relative;font-size: 12px;"></ul>';
            $('div[data-idx='+index+']').after(html);

            $.each(value, function(i, v) {
              html ='<li> <img src="https://ssl.pstatic.net/sstatic/search/pc/img/bu_news_sublst.gif" style="vertical-align:  text-top;"><a href="'+v.url+'" target="_blank"><div style="display: inline-block;overflow: hidden; max-width: 210px;margin-right: 5px;color: #0000ee;text-overflow: ellipsis;white-space: nowrap;word-wrap: normal;word-break: normal;vertical-align: top;">'+v.media_title+'</div></a><span class="txt_sinfo" style="display: inline-block;overflow: hidden;max-width: 260px;white-space: nowrap;text-overflow: ellipsis;vertical-align: top;"><span class="press" style="color: #666;">'+v.media_name+'</span><span class="bar" style="color: #666;display: inline-block;overflow: hidden;width: 0;height: 11px;margin: -1px 5px 1px 4px;border-left: 1px solid #eaeaea;vertical-align: middle;"></span> '+v.writeDate+' </span> </li>';
              $('div[data-idx='+index+']').siblings('.relation_lst').append(html);
            });
          });
          // 데이터 없을 시
          $.each([ 1,2,3,5,6 ], function( index, value ) {
            dataNoneSetting(value,'');
          });
          dataNoneSetting('issue','other');
          dataNoneSetting('marketing','other');
          dataNoneSetting('4','showbox');
        }
      }
    });

  }
  // 데이터 없을 시 1
  function dataNoneSetting(num,type){
    if(type == ''){
      if($('div[data-type='+num+'] .section-body div').length == 0){
        var html = '<p style="text-align: center;margin:  0px;margin-top: 15px;font-size:  12px;font-weight:  bold;color: #666;">해당 데이터 없습니다.</p>';
        $('div[data-type='+num+'] .section-body').append(html);
      }
    }
    else if(type=='showbox'){
      if($('div[data-type='+num+'] .section-body tbody tr').length < 2){
        var html = '<tr><td colspan="3"><p style="text-align: center;margin:  0px;margin-top: 15px;font-size:  12px;font-weight:  bold;color: #666;">해당 데이터 없습니다.</p></td></tr>';
        $('div[data-type='+num+'] .section-body tbody').append(html);
      }
    }
    else{
      if($('div[data-type='+num+'] .section-body tbody tr').length < 1){
        var issueStr = (num == 'issue') ? 'colspan=2' : '';
        var html = '<tr><td '+issueStr+'><p style="text-align: center;margin:  0px;margin-top: 15px;font-size:  12px;font-weight:  bold;color: #666;">해당 데이터 없습니다.</p></td></tr>';
        $('div[data-type='+num+'] .section-body tbody').append(html);
      }
    }
  }
  // 박스오피스
  function boxoffice(){
    var movieDate = $('#datepicker2').val().replace(/[-]/gi,'');
    if(getTimeStamp() == $('#datepicker2').val()){
      movieDate = yesterday($('#datepicker2').val(),'');
    }

    var movieAPI = new KobisOpenAPIRestService('0c4c68be2ac6da9c6283754c7fdac877');
    var result = movieAPI.getDailyBoxOffice(true,{targetDt:movieDate});
    $('#movieList').empty();
    $.each(result.boxOfficeResult.dailyBoxOfficeList, function(index, value) {
      // console.log(value.rank + ': '+ value.movieNm +" " + value.rankInten +'='+value.audiAcc);
      var html= '<tr><td style="padding-top: 10px; padding-left: 5px; padding-bottom:10px;border-bottom: 1px solid #f4f4f4;"><span style="background: #707070;color:  white;width: 18px;height:  10px;display:  inherit;text-align:  center;border-radius:  2px;padding: 2px;">'+value.rank+'</span></td><td style="border-bottom: 1px solid #f4f4f4;">'+value.movieNm+'</td><td style="border-bottom: 1px solid #f4f4f4;color: #666;">'+numberWithCommas(value.audiAcc)+' 명</td><td style="border-bottom: 1px solid #f4f4f4;">';
      var rankIntenVal = Math.abs(value.rankInten);
      if(Number(value.rankInten) > 0){
        html +='<img src="http://showbox.email/images/newsclipping/up_icon.jpg" alt="" style="display: inherit; float:left;">';
      }
      else if(Number(value.rankInten) < 0){
        html +='<img src="http://showbox.email/images/newsclipping/down_icon.jpg" alt="" style="display: inherit; float:left;">';
      }
      else{
        rankIntenVal = '-';
      }
      html +='<span style="padding-left:  12px;vertical-align: -webkit-baseline-middle;">'+rankIntenVal+'</span></td></tr>';
      $('#movieList').append(html);
    });
  }

  // 메일 발송 버튼 클릭시
  $(".sendBtn").on("click",function(){
    var param = {
      'M_sender': $(".sender-select").select2("val"),
      'M_recipi': $(".recipi-select").select2("val"),
      'M_group': $('.group-select').val() || [],
      'M_body': $("#M_body").parents('.col-sm-10').html(),
      'M_type': $("input:radio[name=M_type]:checked").val()
    };
    var check=true;
    if(param["M_sender"] == null){
      check = requiredMessage("M_sender","보내는 사람를 선택해주세요.");
    }
    if(param["M_recipi"] == ""){
      check = requiredMessage("M_recipi","받는사람을 선택해주세요.");
    }
    if($('#datepicker2').val() == ""){
      check = requiredMessage("datepicker2","보고날짜를 선택해주세요.");
    }
    if(param["M_body"] == "" || param["M_body"] == "<p><br></p>"){
      check = requiredMessage("M_body","메일내용 입력해주세요.");
    }
    if(param["M_type"] == "1"){
      var time = $('#timepicker').val();
      var date = $('#datepicker').val();
      if(time == "" || date == ""){
        check = requiredMessage("date","예약시간을 설정해주세요.");
      }
      else if(time.split(' : ')[1] % 10 != 0){
        check = requiredMessage("date","예약시간은 10분단위로 설정해주세요.");
      }
      else{
        var endDate = date+" "+time.replace(' : ',':')+":00";
        var startDateCompare = new Date();
        var endDateCompare = new Date(endDate);
        if(startDateCompare.getTime() >= endDateCompare.getTime()){
          check = requiredMessage("date","현재시간보다 작습니다.");
        }
        else{
          param['end_reserve_time'] = date+" "+time.replace(' : ',':')+":00";
        }
      }
    }
    if(check == false){
      return false;
    }
    swal({
      title: "본문의 내용이 확실합니까?",
      icon: "warning",
      // buttons: ["취소", true],
      dangerMode: true,
      button: {
        text: "보내기",
        closeModal: false,
      }
    })
    .then(function(value) {
      if (value != null) {
        $('span.messages').find('.error').text('');
        var dateStr = $.datepicker.formatDate('yy-mm-dd', new Date($('#datepicker2').val()));
        param['M_subject'] = '['+dateStr+'] 일일 주요 뉴스';
        SendEmails(param);
      }
    });
  });
  // 메일 insert ajax
  function SendEmails(param){
    $.ajax({
      url: '/newsclipping/send',
      type: 'post',
      data : param,
      datatype : 'json',
      error:function(request,status,error){
        console.log('code:'+request.status+'\n'+'message:'+request.responseText+'\n'+'error:'+error);
        swal("ERROR!", request.responseText, "error");
      },
      success:function(data){
        if(data.status){
          swal("SUCCESS!", '메일발송 완료했습니다.', "success")
          .then(function(){
            location.reload();
          });
        }else{
          swal("ERROR!", '새로고침 후 다시 시도해주세요.', "error");
        }
      }
    });
  }
  // input box 경고문
  function requiredMessage(target,msg){
    $("#"+target).siblings('.messages').children('.error').text(msg);
    return false;
  }

  // 예약기능 클릭시
  $('input[name=M_type]').on('change',function(){
    $('.reserveTime').toggle();
  });
  // 예약시간
  var dt = new Date();
  var options = {
    now: dt.getHours()+":"+String(Math.ceil(dt.getMinutes() / 10) * 10),
    twentyFour: true, //Display 24 hour format, defaults to false
    upArrow: 'wickedpicker__controls__control-up', //The up arrow class selector to use, for custom CSS
    downArrow: 'wickedpicker__controls__control-down', //The down arrow class selector to use, for custom CSS
    close: 'wickedpicker__close', //The close class selector to use, for custom CSS
    hoverState: 'hover-state', //The hover state class to use, for custom CSS
    title: '10분단위로 설정해주세요.', //The Wickedpicker's title,
    showSeconds: false, //Whether or not to show seconds, secondsInterval: 1, //Change interval for seconds, defaults to 1  ,
    minutesInterval: 10, //Change interval for minutes, defaults to 1
    beforeShow: null, //A function to be called before the Wickedpicker is shown
    show: null, //A function to be called when the Wickedpicker is shown
    clearable: false, //Make the picker's input clearable (has clickable "x")
  };
  $('#timepicker').wickedpicker(options);
  // 예약날짜
  $('#datepicker').datepicker({
    dateFormat: 'yy-mm-dd',
    prevText: '이전 달',
    nextText: '다음 달',
    monthNames: ['1월','2월','3월','4월','5월','6월','7월','8월','9월','10월','11월','12월'],
    monthNamesShort: ['1월','2월','3월','4월','5월','6월','7월','8월','9월','10월','11월','12월'],
    dayNames: ['일','월','화','수','목','금','토'],
    dayNamesShort: ['일','월','화','수','목','금','토'],
    dayNamesMin: ['일','월','화','수','목','금','토'],
    yearSuffix: '년',
    showMonthAfterYear: true,
    minDate: 0,
    maxDate: "+7D"
  });
  // 일일보고날짜
  $('#datepicker2').daterangepicker({
    singleDatePicker: true,
    showDropdowns: true,
    locale: {
      format: 'YYYY-MM-DD',
      "customRangeLabel": "Custom",
      "daysOfWeek": [
          "일", "월", "화", "수", "목", "금", "토"
      ],
      "monthNames": [
        "1월", "2월", "3월", "4월", "5월", "6월", "7월", "8월", "9월", "10월", "11월", "12월"
      ],
    }
  });
</script>
