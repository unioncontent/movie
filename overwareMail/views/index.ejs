<div class="main-body">
  <div class="page-wrapper">
    <div class="page-header">
      <div class="page-header-title">
        <h4>대시보드</h4>
      </div>
      <div class="page-header-breadcrumb">
        <ul class="breadcrumb-title">
          <li class="breadcrumb-item">
            <a href="/">
              <i class="fas fa-home"></i>
            </a>
          </li>
          <li class="breadcrumb-item"><a href="#!">대시보드</a></li>
        </ul>
      </div>
    </div>
    <div class="page-body">
      <div class="row">
        <div class="col-lg-12">
          <div class="card">
            <div class="card-header">
              <h5>최근 발송 현황 그래프</h5>
              <div class="card-header-right">
                <i class="fas fa-chevron-down"></i>
              </div>
            </div>
            <div class="card-block">
              <div id="7DayGraph" style="height: 300px; position: relative;"></div>
            </div>
          </div>
        </div>
        <div class="col-md-12">
          <div class="card">
            <div class="card-block table-border-style">
              <div class="table-responsive">
                <table class="table table-cp table-bordered">
                  <thead>
                    <tr>
                      <th width="10%">날짜</th>
                      <th>키워드</th>
                      <th>제목</th>
                      <th>발송건</th>
                      <th>성공</th>
                      <th>성공</th>
                      <th>발송타입</th>
                    </tr>
                  </thead>
                  <tbody>
                    <%for(var i=0; i < list.length; i++) {%>
                    <tr>
                      <th><%= list[i].M_regdate %></th>
                      <td><div class="kwd_nobr"><%= list[i].M_keyword %></div></td>
                      <td><div class="title_nobr"><%= list[i].M_subject %></div></td>
                      <td><%= parseInt(list[i].success) + parseInt(list[i].fail) %></td>
                      <td><%= list[i].success %></td>
                      <td><%= list[i].fail %></td>
                      <td>
                        <%=(list[i].M_type == '0') ? '즉시' : '예약'%>
                        <% if((new Date().getTime() < new Date(list[i].M_send).getTime())){ %>
                        <label class="badge badge-danger">대기</label>
                        <%}%>
                      </td>
                    </tr>
                    <% } %>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- morris -->
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css">
<style type="text/css">
.table-cp td,.table-cp th{
  text-align: center;
}
.title_nobr,.kwd_nobr{
  font-size: 15px;
  padding-left: 3px;
  text-overflow: ellipsis;
  width: 500px;
  overflow: hidden;
}
.kwd_nobr{
  width: 146px;
}
</style>
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js"></script>

<script type="text/javascript">
$(window).resize(function(){
  window.areaChart.redraw();
});

$(document).ready(function(){
  areaChart();
});

function areaChart(){
  $.ajax({
    url: '/7DayGraph',
    type: 'post',
    datatype : 'json',
    error:function(request,status,error){
      console.log('code:'+request.status+'\n'+'message:'+request.responseText+'\n'+'error:'+error);
    },
    success:function(data){
      console.log(data);
      var arr = [];
      if(data){
        data.forEach(function(item,idx){
          arr.push({'date':item.date,'success':item.success,'fail':item.fail});
        });
      }
      else{
        arr.push({'date':0,'success':0,'l3':0});
      }
      window.areaChart = Morris.Line({
        element: '7DayGraph',
        data: arr,
        lineColors: ['#1abc9c', '#df6161'],
        xkey: 'date',
        ykeys: ['success', 'fail'],
        labels: ['성공', '실패'],
        resize: true,
        xLabels:'day',
        hideHover: 'auto'
      });
    }
  });
}

</script>
